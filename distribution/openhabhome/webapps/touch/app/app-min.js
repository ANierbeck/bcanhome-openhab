function setCurrentLeftNavPage(a){currentLeftNavPage=a}function refreshTitle(){if(deviceType=="Phone"){if(broadCrumb.length==1){Ext.getCmp("back_btn").hide()}else{Ext.getCmp("back_btn").show()}broadCrumbText=broadCrumb[broadCrumb.length-1][1].replace(/[\[\]']+/g,"")}else{broadCrumbText="";for(var a in broadCrumb){broadCrumbText+=broadCrumb[a][1].replace(/[\[\]']+/g,"");if(a!=broadCrumb.length-1){broadCrumbText+=" > "}}}Ext.getCmp("title").setHtml(broadCrumbText)}function setTitle(a){broadCrumb[broadCrumb.length-1][1]=a;refreshTitle()}function createImageWidget(a){return{xtype:"oph_imagefield",url:a,cls:"x-image-field"}}function createUnsupportedWidget(){return{xtype:"field",label:"[UNSUPPORTED WIDGET]"}}function createButtonsWidget(a,b){return{xtype:"oph_buttons_selectfield",options:b,oph_item:a}}function createSelectionWidget(a,b){return{xtype:"oph_selectfield",options:b,oph_item:a}}function createImageLinkWidget(a,b,c){return{xtype:"oph_imagelink",url:a,page_id:b,page_label:c}}function createLinkWidget(a,b){return{xtype:"oph_buttonfield",page_id:a,page_label:b}}function createRollershutterWidget(a){return{xtype:"oph_rollershutterfield",oph_item:a}}function createToggleWidget(a){return{xtype:"oph_togglefield",oph_item:a}}function createTextWidget(){return{xtype:"oph_textfield"}}function createSliderWidget(a){return{xtype:"oph_sliderfield",minValue:0,maxValue:100,oph_item:a}}function sendCommand(a,b){if(a){oph_communication.request({comm_method:"ajax",url:"/rest/items/"+a+"/",method:"POST",params:b,headers:{"Content-Type":"text/plain"},failure:function(){}})}}function setProfile(){deviceType=localStorage.getItem("openHAB_device_type");if(deviceType&&deviceType!="Auto"){}else{deviceType=Ext.os.deviceType}if(deviceType=="Phone"){deviceTypeCls="oph_phone"}else if(deviceType=="Tablet"){deviceTypeCls="oph_tablet"}else{deviceTypeCls="oph_desktop"}}function updateLeftNavMenu(a){nav_store=Ext.getCmp("leftPanel").getActiveItem().getStore();nav_items=nav_store.data.items;for(i in nav_items){nav_store.getAt(i).set("text",a[nav_store.getAt(i).data.name].label.replace(/[\[\]']+/g,""));nav_store.getAt(i).set("icon",a[nav_store.getAt(i).data.name].icon)}}function updateLeftNavMenuItem(a,b,c){nav_store=Ext.getCmp("leftPanel").getActiveItem().getStore();index=nav_store.find("page_id",a);nav_store.getAt(index).set("text",b.replace(/[\[\]']+/g,""));nav_store.getAt(index).set("icon",c)}function updateWidgetsAjax(a,b){if(a==getCurrentPageId()){var c="";var d=6e4;if(!b||b=="normal"){c={Accept:"application/json"}}else if(b=="long-poll"){c={Accept:"application/json","X-Atmosphere-Transport":"long-polling"};d=18e4}Ext.Ajax.abort();Ext.Ajax.request({url:"/rest/sitemaps/"+sitemap+"/"+a,headers:c,disableCaching:true,timeout:d,failure:function(c){if(b=="long-poll"){updateWidgetsAjax(a,"long-poll")}else{alert(OpenHAB.i18n_strings[ui_language].error_server_connection);updateWidgetsAjax(a,"long-poll")}},success:function(b){if(b.statusText=="OK"){var c=Ext.JSON.decode(b.responseText);updateModel={};var d=0;if(Ext.isArray(c.widget)){for(var e=0 in c.widget){if(c.widget[e].type=="Frame"){if(Ext.isArray(c.widget[e].widget)){for(var f=0 in c.widget[e].widget){updateModel["obj"+d]=c.widget[e].widget[f];d++}}else{updateModel["obj"+d]=c.widget[e].widget;d++}}else{updateModel["obj"+d]=c.widget[e];d++}}}else{updateModel["obj"+d]=c.widget;d++}newCard.setValuesData(updateModel);if(deviceType!="Phone"){if(c.parent&&c.parent.id==currentLeftNavPage){setTitle(c.title);updateLeftNavMenuItem(c.id,c.title,c.icon)}else if(c.id==currentLeftNavPage){refreshTitle();updateLeftNavMenu(updateModel)}else{refreshTitle()}}else{setTitle(c.title)}}else{alert(OpenHAB.i18n_strings[ui_language].error_server_connection)}updateWidgetsAjax(a,"long-poll")}})}}function goToPage(a){newCard=new Oph.form.Panel({scrollable:"vertical",autoDestroy:true,cls:["oph_widgets_container",deviceTypeCls+"_widgets_container"]});newCard.add(UIobjects[a]);Ext.getCmp("content").setActiveItem(newCard)}function backPage(){if(broadCrumb.length>1){broadCrumb.pop();Ext.getCmp("content").getLayout().setAnimation({type:"slide",direction:"right"});goToPage(broadCrumb[broadCrumb.length-1][0])}}function tapHandler(a,b){if(deviceType=="Phone"){broadCrumb.push([a.page_id,a.page_label]);Ext.getCmp("content").getLayout().setAnimation({type:"slide",direction:"left"});goToPage(a.page_id)}else{leftNav=Ext.getCmp("leftPanel").getActiveItem();index=leftNav.getStore().getAt(leftNav.getStore().find("page_id",a.page_id)).data.index;leftNav.select(index,false,false);NavBarItemTap(leftNav,index)}}function NavBarItemTap(a,b,c,d){leftNavPanel.getBackButton().show();if(a.getStore().getAt(b).data.leaf){if(clickOnLeaf){broadCrumb.pop()}clickOnLeaf=true}else{if(clickOnLeaf){broadCrumb.pop()}clickOnLeaf=false;setCurrentLeftNavPage(a.getStore().getAt(b).data.page_id)}broadCrumb.push([a.getStore().getAt(b).data.page_id,a.getStore().getAt(b).data.page_label]);if(UIobjects[a.getStore().getAt(b).data.page_id].length>0){goToPage(a.getStore().getAt(b).data.page_id)}}function showSettingsWindow(){if(settingsPanel){settingsPanel.destroy();settingsPanel=null}else{settingsPanel=new Ext.Panel(settingsWindow);settingsPanel.setCls(deviceTypeCls+"_modal");settingsPanel.getItems().items[1].setValue(localStorage.getItem("openHAB_sitemap"));settingsPanel.getItems().items[2].setValue(localStorage.getItem("openHAB_device_type"));var a=new Array;for(var b in OpenHAB.i18n_strings){a.push({text:OpenHAB.i18n_strings[b].language_name,value:b})}settingsPanel.getItems().items[3].setOptions(a);settingsPanel.getItems().items[3].setValue(localStorage.getItem("openHAB_language"));a=[];for(var b in OpenHAB.themes){a.push({text:OpenHAB.themes[b],value:OpenHAB.themes[b]})}settingsPanel.getItems().items[4].setOptions(a);settingsPanel.getItems().items[4].setValue(localStorage.getItem("openHAB_theme"));Ext.Viewport.add(settingsPanel)}}function addButtonToLeftNav(a,b,c){pushWidget({icon:b.icon,text:b.label.replace(/[\[\]']+/g,""),page_id:b.linkedPage.id,page_label:b.linkedPage.title,leaf:true,name:"obj"+a},c.items);c.leaf=false;c.items[c.items.length-1].items=new Array;return c.items[c.items.length-1]}function addsWidget(a,b,c,d){var e;var f;if(b.type=="Switch"){if(b.item&&b.item.type=="RollershutterItem"){e=createRollershutterWidget(b.item?b.item.name:"",b.mapping)}else if(b.item&&b.item.type=="NumberItem"){e=createButtonsWidget(b.item?b.item.name:"",b.mapping)}else if(b.item&&b.item.type=="SwitchItem"&&b.mapping){e=createButtonsWidget(b.item?b.item.name:"",b.mapping)}else if(b.item&&b.item.type=="GroupItem"&&b.mapping){e=createButtonsWidget(b.item?b.item.name:"",b.mapping)}else{e=createToggleWidget(b.item?b.item.name:"")}}else if(b.type=="Slider"){e=createSliderWidget(b.item?b.item.name:"")}else if(b.type=="Text"){if(b.linkedPage){if(deviceType=="Phone"){e=createLinkWidget(b.linkedPage.id,b.linkedPage.title)}else{f=addButtonToLeftNav(a,b,d)}buildUIArray(b.linkedPage,f)}else{e=createTextWidget()}}else if(b.type=="Group"){if(deviceType=="Phone"){e=createLinkWidget(b.linkedPage.id,b.linkedPage.title)}else{f=addButtonToLeftNav(a,b,d)}buildUIArray(b.linkedPage,f)}else if(b.type=="Selection"){e=createSelectionWidget(b.item?b.item.name:"",b.mapping)}else if(b.type=="Image"){if(b.linkedPage){if(deviceType=="Phone"){e=createImageLinkWidget(b.url,b.linkedPage.id,b.linkedPage.title)}else{f=addButtonToLeftNav(a,b,d);e=createImageLinkWidget(b.url,b.linkedPage.id,b.linkedPage.title)}buildUIArray(b.linkedPage,f)}else{e=createImageWidget(b.url)}}else if(b.type=="Frame"){}else{e=createUnsupportedWidget()}if(e){e.name="obj"+a}return e}function clearEmptyFrames(){for(var a in UIobjects){var b=[];for(var c in UIobjects[a]){if(UIobjects[a][c].items.length>0){b.push(UIobjects[a][c])}}UIobjects[a]=b}}function buildUIArray(a,b){if(a){var c;UIobjects[a.id]=new Array;c=UIobjects[a.id];var d=0;var e=a.widget;if(Ext.isArray(e)){var f=false;for(var g in e){if(e[g].type!="Frame"){if(!f){c.push({xtype:"fieldset",title:"",cls:["oph_fieldset",deviceTypeCls+"_fieldset","oph_clearfix"]});c=c[c.length-1]["items"]=new Array;f=true}pushWidget(addsWidget(d,e[g],c,b),c);d++}else if(e[g].type=="Frame"){f=false;c.push({xtype:"fieldset",title:e[g].label,cls:["oph_fieldset",deviceTypeCls+"_fieldset","oph_clearfix"]});c[c.length-1]["items"]=new Array;if(Ext.isArray(e[g].widget)){for(var h in e[g].widget){pushWidget(addsWidget(d,e[g].widget[h],c[c.length-1]["items"],b),c[c.length-1]["items"]);d++}}else{pushWidget(addsWidget(d,e[g].widget,c[c.length-1]["items"],b),c[c.length-1]["items"]);d++}}}}else{if(e.type!="Frame"){c.push({xtype:"fieldset",title:"",cls:["oph_fieldset",deviceTypeCls+"_fieldset","oph_clearfix"]});c=c[c.length-1]["items"]=new Array;pushWidget(addsWidget(d,e,c,b),c);d++}else if(e.type=="Frame"){c.push({xtype:"fieldset",title:e.label,cls:["oph_fieldset",deviceTypeCls+"_fieldset","oph_clearfix"]});c[c.length-1]["items"]=new Array;if(Ext.isArray(e.widget)){for(var h in e.widget){pushWidget(addsWidget(d,e.widget[h],c[c.length-1]["items"],b),c[c.length-1]["items"]);d++}}else{pushWidget(addsWidget(d,e.widget,c[c.length-1]["items"],b),c[c.length-1]["items"]);d++}}}}else{alert(OpenHAB.i18n_strings[ui_language].error_build_interface)}}function pushWidget(a,b){if(a){b.push(a)}}function loadUIData(a){Ext.getCmp("content").setMask({message:OpenHAB.i18n_strings[ui_language].loading});oph_communication.request({url:"/rest/sitemaps/"+a,comm_method:"ajax",headers:{Accept:"application/json"},success:function(a){result=Ext.JSON.decode(a.responseText);try{buildUIArray(result.homepage,UInavPanel);clearEmptyFrames();Ext.getCmp("content").unmask();broadCrumb[0]=new Array(result.homepage.id,result.homepage.title);Ext.getCmp("title").setHtml(result.homepage.title);goToPage(result.homepage.id);if(Ext.getCmp("leftPanel")){leftPanelstore.setRootNode(UInavPanel);setCurrentLeftNavPage(result.homepage.id)}}catch(b){Ext.getCmp("content").unmask();alert(OpenHAB.i18n_strings[ui_language].error_build_interface+"\r\n("+b+")")}},failure:function(){alert(OpenHAB.i18n_strings[ui_language].error_server_connection)}})}function getCurrentPageId(){return broadCrumb[broadCrumb.length-1][0]}function getLocalStoreItem(a,b){var c=localStorage.getItem(a);if(!c||c=="null"){return b}else{return c}}Ext.define("Ext.overrides.button.updateHtml",{override:"Ext.Button",updateHtml:function(a){var b=this.textElement;if(a){b.show();b.update(a)}else{b.hide()}}});Ext.define("Oph.Communication",{config:{comm_method:"ajax"},request:function(a){a=a||{};var b=this,c=a.scope||window,d=this.config.comm_method,e=a.method,f=a.params,g=a.success,h=a.failure,i=a.url,j=a.headers,k;if(d=="ajax"){Ext.Ajax.request({url:i,method:e,params:f,headers:j,disableCaching:true,failure:function(c){Ext.callback(a.failure,b.scope,[c])},success:function(c){Ext.callback(a.success,b.scope,[c])}})}else if(d=="websocket"){alert("socket")}},constructor:function(a){this.initConfig(a);if(this.config.comm_method=="websocket"){if("WebSocket"in window){var b=new WebSocket("ws://localhost:8080/");b.onopen=function(){b.send("Message to send");alert("Message is sent...")}}else{alert("websockets not supported")}}}});var UIobjects={};var UInavPanel={text:"Left nav",items:[]};var broadCrumb=new Array;var broadCrumbText="";var newCard;var settingsPanel=null;var updateModel={};var deviceTypeCls="";var deviceType;var clickOnLeaf=false;var firstTime=true;var sitemap;var currentLeftNavPage;var leftNavPanel;theme_css_filename="./themes/"+getLocalStoreItem("openHAB_theme","simple")+"/css/style.css";var theme_css=document.createElement("link");theme_css.setAttribute("rel","stylesheet");theme_css.setAttribute("type","text/css");theme_css.setAttribute("href",theme_css_filename);document.getElementsByTagName("head")[0].appendChild(theme_css);var ui_language=getLocalStoreItem("openHAB_language","en");var oph_communication=Ext.create("Oph.Communication",{comm_method:"ajax"});var sitemapStoreLoadTries=3;var sitemapsStoreSelection=new Ext.data.Store({fields:["name"]});var sitemapsStore=new Ext.data.Store({fields:["name"],autoLoad:true,listeners:{exception:function(a,b,c,d){if(sitemapStoreLoadTries>0){sitemapsStore.load();sitemapStoreLoadTries--}else{sitemapStoreLoadTries=3;alert(OpenHAB.i18n_strings[ui_language].error_server_connection)}},load:function(a,b,c){if(c){sitemapStoreLoadTries=3;sitemapsStoreSelection.insert(0,{name:"- "+OpenHAB.i18n_strings[ui_language].choose_on_startup});sitemapsStore.each(function(a){sitemapsStoreSelection.add(a.copy())})}else{console.log("bau 2");if(sitemapStoreLoadTries>0){sitemapsStore.load();sitemapStoreLoadTries--}else{sitemapStoreLoadTries=3;alert(OpenHAB.i18n_strings[ui_language].error_server_connection)}}}},proxy:{type:"ajax",url:"/rest/sitemaps",headers:{Accept:"application/json"},noCache:true,limitParam:undefined,startParam:undefined,pageParam:undefined,reader:{type:"json",root:"sitemap"}}});var sitemapsWindow={id:"sitemapsWindow",floating:true,centered:true,layout:"fit",scrollable:"vertical",items:[{title:OpenHAB.i18n_strings[ui_language].interfaces,xtype:"toolbar",ui:"light",docked:"top"},{xtype:"list",store:sitemapsStore,singleSelect:true,itemTpl:"{name}",listeners:{itemtap:function(a,b){sitemap=a.getStore().getAt(b).data.name;loadUIData(a.getStore().getAt(b).data.name);Ext.getCmp("sitemapsWindow").destroy()}}}]};var settingsWindow={id:"settingsWindow",floating:true,centered:true,scrollable:"vertical",items:[{title:OpenHAB.i18n_strings[ui_language].settings,xtype:"toolbar",ui:"light",docked:"top"},{xtype:"selectfield",label:OpenHAB.i18n_strings[ui_language].default_sitemap,labelWidth:"40%",store:sitemapsStoreSelection,displayField:"name",valueField:"name"},{xtype:"selectfield",label:OpenHAB.i18n_strings[ui_language].this_device_is,labelWidth:"40%",options:[{text:OpenHAB.i18n_strings[ui_language].auto_detect,value:"Auto"},{text:OpenHAB.i18n_strings[ui_language].phone,value:"Phone"},{text:OpenHAB.i18n_strings[ui_language].tablet,value:"Tablet"},{text:OpenHAB.i18n_strings[ui_language].pc,value:"Desktop"}]},{xtype:"selectfield",label:OpenHAB.i18n_strings[ui_language].interface_language,labelWidth:"40%"},{xtype:"selectfield",label:OpenHAB.i18n_strings[ui_language].theme,labelWidth:"40%"},{xtype:"button",ui:"confirm",text:OpenHAB.i18n_strings[ui_language].save,style:"width:30%;margin:10px 10%;float:left;",scope:this,handler:function(){if(this.settingsPanel.items.items[1].getValue().charAt(0)=="-"){localStorage.setItem("openHAB_sitemap","")}else{localStorage.setItem("openHAB_sitemap",this.settingsPanel.items.items[1].getValue())}localStorage.setItem("openHAB_device_type",this.settingsPanel.items.items[2].getValue());localStorage.setItem("openHAB_language",this.settingsPanel.items.items[3].getValue());localStorage.setItem("openHAB_theme",this.settingsPanel.items.items[4].getValue());this.settingsPanel.destroy();this.settingsPanel=null;alert(OpenHAB.i18n_strings[ui_language].need_to_restart_for_changes_to_take_effect);window.location.reload()}},{xtype:"button",ui:"decline",text:OpenHAB.i18n_strings[ui_language].cancel,style:"width:30%;margin:10px 10%;float:right;",scope:this,handler:function(){this.settingsPanel.destroy();this.settingsPanel=null}}]};Ext.define("LeftPanelListItem",{extend:"Ext.data.Model",fields:[{name:"icon",type:"string"},{name:"text",type:"string"},{name:"page_id",type:"string"},{name:"page_label",type:"string"},{name:"name",type:"string"}]});var leftPanelstore=new Ext.data.TreeStore({model:"LeftPanelListItem",autoLoad:true,proxy:{type:"memory",reader:{type:"json",root:"items"}}});Ext.define("Oph.field.ButtonsSelect",{extend:"Ext.field.Field",xtype:"oph_buttons_selectfield",config:{cls:"x-buttons-field",styleHtmlContent:true,styleHtmlCls:"oph_none",labelWidth:"50%"},constructor:function(a){a=a||{};this.callParent([a])},applyComponent:function(a){component=this;container=Ext.factory({styleHtmlContent:true,styleHtmlCls:"oph_right"},Ext.Container);if(Ext.isArray(this.config.options)){for(var b in this.config.options){item=container.add(Ext.create("Ext.Button",{cls:"x-button-normal oph_selection_btn",item:component.config.oph_item,command:component.config.options[b].command,text:this.config.options[b].label}));item.on({tap:function(){sendCommand(this.item,this.command)}})}}else{item=container.add(Ext.create("Ext.Button",{cls:"x-button-normal oph_selection_btn",item:component.config.oph_item,command:component.config.options.command,text:this.config.options.label}));item.on({tap:function(){sendCommand(this.item,this.command)}})}return container},initialize:function(){this.callParent()},setValueData:function(a){this.setLabel('<img class="oph_icon" src="/images/'+a.icon+'.png" /><div class="oph_label">'+a.label.replace(/[\[\]']+/g,"")+"</div>");if(Ext.isArray(a.mapping)){for(var b in a.mapping){this._component._items.items[b].removeCls("x-button-action");if(a.item.state==a.mapping[b].command){this._component._items.items[b].addCls("x-button-action")}}}else{this._component._items.items[0].addCls("x-button-action")}}});Ext.define("Oph.field.Slider",{extend:"Ext.field.Slider",xtype:"oph_sliderfield",config:{labelWidth:"50%"},constructor:function(a){a=a||{};this.callParent([a])},initialize:function(){this.callParent();this.on({painted:function(a){a._component.element.on({tap:function(){sendCommand(a.config.oph_item,a.getValue())}});a._component.getThumb(0).element.on({dragend:function(){sendCommand(a.config.oph_item,a.getValue())}})}})},setValueData:function(a){if(a.item){this.setValue(a.item.state)}this.setLabel('<img class="oph_icon" src="/images/'+a.icon+'.png" /><div class="oph_label">'+a.label.replace(/[\[\]']+/g,"")+"</div>");return this}});Ext.define("Oph.field.Select",{extend:"Ext.field.Select",xtype:"oph_selectfield",config:{displayField:"label",valueField:"command",labelWidth:"50%"},constructor:function(a){a=a||{};this.callParent([a])},initialize:function(){this.callParent();this.on({painted:function(a){a.on({selected:function(){sendCommand(a.config.oph_item,a.getValue())}})}})},setValueData:function(a){if(a.item){this.setValue(a.item.state)}this.setLabel('<img class="oph_icon" src="/images/'+a.icon+'.png" /><div class="oph_label">'+a.label.replace(/[\[\]']+/g,"")+"</div>");return this},onListSelect:function(a,b){var c=this;if(b){c.setValue(b);this.fireEvent("selected",this)}},onPickerChange:function(a,b){var c=this,d=c.getValue(),e=b[c.getName()],f=c.getStore(),g=f.find(c.getValueField(),e);record=f.getAt(g);c.setValue(record);this.fireEvent("selected",this)}});Ext.define("Oph.field.Text",{extend:"Ext.field.Field",xtype:"oph_textfield",config:{cls:"x-textfield",styleHtmlContent:true,styleHtmlCls:"oph_none",labelWidth:"50%"},constructor:function(a){a=a||{};this.callParent([a])},initialize:function(){this.callParent()},setValueData:function(a){this.setHtml(a.label.match(/\[(.*?)\]/)?a.label.match(/\[(.*?)\]/)[1]:a.label);this.setLabel('<img class="oph_icon" src="/images/'+a.icon+'.png" /><div class="oph_label">'+a.label.replace(/\[(.*?)\]/,"")+"</div>");return this}});Ext.define("Oph.field.Toggle",{extend:"Ext.field.Toggle",xtype:"oph_togglefield",config:{labelWidth:"50%"},constructor:function(a){a=a||{};this.callParent([a])},initialize:function(){this.callParent();this.on({painted:function(a){a._component.element.on({tap:function(){sendCommand(a.config.oph_item,a.formatOutputValue(a.getValue()))}});a._component.getThumb(0).element.on({dragend:function(){sendCommand(a.config.oph_item,a.formatOutputValue(a.getValue()))}})}})},setValueData:function(a){if(a.item){this.setValue(this.formatInputValue(a.item.state))}this.setLabel('<img class="oph_icon" src="/images/'+a.icon+'.png" /><div class="oph_label">'+a.label.replace(/[\[\]']+/g,"")+"</div>");return this},formatInputValue:function(a){if(a=="ON"){return 1}else{return 0}},formatOutputValue:function(a){if(a==1){return"ON"}else if(a==0){return"OFF"}}});Ext.define("Oph.field.Rollershutter",{extend:"Ext.field.Field",xtype:"oph_rollershutterfield",config:{cls:"x-rollershutter-field",styleHtmlContent:true,styleHtmlCls:"oph_none",labelWidth:"50%"},constructor:function(a){a=a||{};this.callParent([a])},applyComponent:function(a){component=this;container=Ext.factory({styleHtmlContent:true,styleHtmlCls:"oph_right"},Ext.Container);but1=container.add(Ext.create("Ext.Button",{cls:"x-button-normal oph_rollershutter_btn",longPress:false,iconCls:"arrow_up",iconMask:true}));but1.element.item=component.config.oph_item;but1.element.on({touchstart:function(){sendCommand(this.item,"UP")},longpress:function(){but1.longPress=true},tap:function(){if(but1.longPress){but1.longPress=false;sendCommand(component.config.oph_item,"STOP")}}});but2=container.add(Ext.create("Ext.Button",{cls:"x-button-normal oph_rollershutter_btn",iconCls:"delete",iconMask:true}));but2.element.item=component.config.oph_item;but2.on({tap:function(){sendCommand(component.config.oph_item,"STOP")}});but3=container.add(Ext.create("Ext.Button",{cls:"x-button-normal oph_rollershutter_btn",longPress:false,iconCls:"arrow_down",iconMask:true}));but3.element.item=component.config.oph_item;but3.element.on({touchstart:function(){sendCommand(this.item,"DOWN")},longpress:function(){but3.longPress=true},tap:function(){if(but3.longPress){but3.longPress=false;sendCommand(component.config.oph_item,"STOP")}}});return container},initialize:function(){this.callParent()},initialize:function(){this.callParent()},setValueData:function(a){this.setLabel('<img class="oph_icon" src="/images/'+a.icon+'.png" /><div class="oph_label">'+a.label.replace(/[\[\]']+/g,"")+"</div>");return this}});Ext.define("Oph.field.Button",{extend:"Ext.Button",xtype:"oph_buttonfield",isField:true,config:{style:"display:block",baseCls:"x-form-label x-field oph_group_btn",labelCls:"",isField:true,cls:"oph_link"},constructor:function(a){a=a||{};this.callParent([a])},initialize:function(){this.callParent()},setValueData:function(a){this.setHtml('<img class="oph_icon" src="/images/'+a.icon+'.png" />'+a.label.replace(/[\[\]']+/g,""));return this},getName:function(){return this.config.name}});Ext.define("Oph.field.Image",{extend:"Ext.Container",xtype:"oph_imagefield",constructor:function(a){a=a||{};this.callParent([a]);if(a.url.substr(0,4)!="http"&&a.url.substr(0,1)!="/"){a.url="/"+a.url}this.setHtml('<div style="width:100%;padding:0.4em;"><img src="'+a.url+'" style="width:100%;"></div>')},initialize:function(){this.callParent()},setValueData:function(a){}});Ext.define("Oph.field.ImageLink",{extend:"Ext.Button",xtype:"oph_imagelink",config:{style:"display:block",baseCls:"none",labelCls:"",cls:"oph_link"},constructor:function(a){a=a||{};this.callParent([a]);if(a.url.substr(0,4)!="http"&&a.url.substr(0,1)!="/"){a.url="/"+a.url}this.setHtml('<div style="width:100%;padding:0.4em;"><img src="'+a.url+'" style="width:100%;"></div>')},initialize:function(){this.callParent()},setValueData:function(a){}});Ext.define("Oph.form.Panel",{extend:"Ext.Panel",xtype:"oph_formpanel",constructor:function(a){a=a||{};this.callParent([a])},initialize:function(){this.callParent()},setValuesData:function(a){var b=this.getFields(),c,d,e;a=a||{};for(c in a){if(a.hasOwnProperty(c)){d=b[c];e=a[c];if(d){d.setValueData(e)}}}return this},getFields:function(a){var b={},c;var d=function(e){if(e.isField){c=e.getName();if(a&&c==a||typeof a=="undefined"){if(b.hasOwnProperty(c)){if(!Ext.isArray(b[c])){b[c]=[b[c]]}b[c].push(e)}else{b[c]=e}}}if(e.isContainer){e.items.each(d)}};this.items.each(d);return a?b[a]||[]:b}});Ext.setup({onReady:function(){setProfile();var a=Ext.create("Ext.Panel",{layout:{type:"card",animation:{type:"slide",direction:"left"}},cls:"oph_background",fullscreen:true,id:"content",autoDestroy:true,items:[{docked:"top",xtype:"toolbar",ui:"light",items:[{id:"back_btn",ui:"back",text:OpenHAB.i18n_strings[ui_language].back,handler:backPage,hidden:true},{xtype:"spacer"},{id:"title",xtype:"label",cls:"oph_title",centered:true},{xtype:"spacer"},{id:"settings_btn",iconCls:"settings",iconMask:true,handler:showSettingsWindow}]}]});a.onAfter("activeitemchange",function(a,b,c,d){var e=0;var f=0;var g=b.getItems();for(var h=0;h<g.length;h++){if(e>f){f+=g.items[h].element.dom.clientHeight;g.items[h].addCls(deviceTypeCls+"_fieldset_right")}else{e+=g.items[h].element.dom.clientHeight;g.items[h].addCls(deviceTypeCls+"_fieldset_left")}}updateWidgetsAjax(broadCrumb[broadCrumb.length-1][0],"normal");if(c){setTimeout(function(){c.clearListeners();c.removeAll(true);c.destroy()},1e3)}b.on({tap:tapHandler,delegate:"button"})},a);if(deviceType!="Phone"){a.getLayout().setAnimation({type:"fade",duration:500});leftNavPanel=Ext.Viewport.add(new Ext.NestedList({docked:"left",width:"14em",scrollable:"auto",id:"leftPanel",backText:OpenHAB.i18n_strings[ui_language].back,updateTitleText:false,store:leftPanelstore,listeners:{itemtap:NavBarItemTap},getItemTextTpl:function(a){return'<tpl if="icon"><img class="oph_icon" src="/images/{icon}.png" /></tpl><div class="oph_label">{text}</div>'}}));leftNavPanel.doBack=function(a,b,c,d){broadCrumb.pop();if(UIobjects[broadCrumb[broadCrumb.length-1][0]].length>0){if(clickOnLeaf){a.getActiveItem().deselectAll()}else{this.goToNode(b.parentNode)}}else{broadCrumb.pop();this.goToNode(b.parentNode)}clickOnLeaf=false;goToPage(broadCrumb[broadCrumb.length-1][0]);setCurrentLeftNavPage(broadCrumb[broadCrumb.length-1][0]);if(broadCrumb.length<=1){a.getBackButton().hide()}};leftNavPanel.syncToolbar=function(a){}}sitemap=localStorage.getItem("openHAB_sitemap");if(sitemap){loadUIData(sitemap)}else{var b=new Ext.Panel(sitemapsWindow);b.setCls(deviceTypeCls+"_modal");Ext.Viewport.add(b)}}})